<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIè¯ç‰©ååº”é¢„æµ‹è¯„ä¼°ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .nav-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            background: #667eea;
            color: white;
        }

        .nav-btn:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }

        .nav-btn.active {
            background: #764ba2;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: #666;
            font-size: 0.9rem;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: #667eea;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .logout-btn {
            padding: 0.25rem 0.75rem;
            border: 1px solid #ddd;
            background: white;
            color: #666;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .logout-btn:hover {
            background: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .page {
            display: none;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* ç™»å½•é¡µé¢æ ·å¼ */
        .login-container {
            max-width: 500px;
            margin: 10vh auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            overflow: hidden;
        }

        .login-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .login-form {
            padding: 2rem;
        }

        .form-step {
            display: none;
        }

        .form-step.active {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .page-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .page-content {
            padding: 2rem;
        }

        .disease-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .disease-tab {
            padding: 0.75rem 1.5rem;
            border: none;
            background: none;
            color: #666;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .disease-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 3rem;
            text-align: center;
            margin: 2rem 0;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .upload-area.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .survey-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .survey-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            background: white;
        }

        .survey-card:hover {
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .survey-card.completed {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.05);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .card-title {
            font-weight: bold;
            color: #333;
        }

        .card-status {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .card-info {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.4;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #333;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border-radius: 6px;
            transition: background 0.3s ease;
        }

        .radio-item:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        .select-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .rating-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .rating-table th,
        .rating-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .rating-table th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .rating-controls {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
        }

        .rating-btn {
            width: 40px;
            height: 40px;
            border: 2px solid #ddd;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .rating-btn:hover {
            border-color: #667eea;
        }

        .rating-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .model-report {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
            border-left: 4px solid #667eea;
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            cursor: pointer;
        }

        .report-content {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 6px;
            padding: 1rem;
            background: white;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #eee;
            border-radius: 4px;
            margin: 1rem 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .patient-info {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            font-weight: 600;
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .info-value {
            color: #333;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin: 2rem 0 1rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #667eea;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
        }

        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #ddd;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 1rem;
            font-weight: bold;
        }

        .step.active {
            background: #667eea;
        }

        .step.completed {
            background: #28a745;
        }

        .welcome-message {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #667eea;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
            margin: 0.5rem 0;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 1rem;
            }
            
            .nav {
                flex-direction: column;
                gap: 1rem;
            }
            
            .survey-grid {
                grid-template-columns: 1fr;
            }
            
            .rating-controls {
                flex-wrap: wrap;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .select-group {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ç™»å½•ç•Œé¢ -->
    <div id="login-container" class="login-container">
        <div class="login-header">
            <h1>ğŸ¥ AIè¯ç‰©ååº”é¢„æµ‹è¯„ä¼°ç³»ç»Ÿ</h1>
            <p>ä¸´åºŠä¸“å®¶ç™»å½•</p>
        </div>
        <div class="login-form">
            <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
            <div class="step-indicator">
                <div class="step active" id="step1">1</div>
                <div class="step" id="step2">2</div>
            </div>

            <!-- ç¬¬ä¸€æ­¥ï¼šåŸºæœ¬ä¿¡æ¯ -->
            <div class="form-step active" id="login-step1">
                <h3 style="margin-bottom: 1.5rem;">åŸºæœ¬ä¿¡æ¯</h3>
                
                <div class="form-group">
                    <label class="form-label" for="doctor-name">å§“å *</label>
                    <input type="text" id="doctor-name" class="form-control" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="doctor-title">èŒç§° *</label>
                        <select id="doctor-title" class="form-control" required>
                            <option value="">è¯·é€‰æ‹©èŒç§°</option>
                            <option value="ä½é™¢åŒ»å¸ˆ">ä½é™¢åŒ»å¸ˆ</option>
                            <option value="ä¸»æ²»åŒ»å¸ˆ">ä¸»æ²»åŒ»å¸ˆ</option>
                            <option value="å‰¯ä¸»ä»»åŒ»å¸ˆ">å‰¯ä¸»ä»»åŒ»å¸ˆ</option>
                            <option value="ä¸»ä»»åŒ»å¸ˆ">ä¸»ä»»åŒ»å¸ˆ</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="doctor-experience">å·¥ä½œå¹´èµ„ *</label>
                        <select id="doctor-experience" class="form-control" required>
                            <option value="">è¯·é€‰æ‹©å¹´èµ„</option>
                            <option value="1-3å¹´">1-3å¹´</option>
                            <option value="4-7å¹´">4-7å¹´</option>
                            <option value="8-15å¹´">8-15å¹´</option>
                            <option value="15å¹´ä»¥ä¸Š">15å¹´ä»¥ä¸Š</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="doctor-specialty">ä¸“ä¸šæ–¹å‘ *</label>
                    <select id="doctor-specialty" class="form-control" required>
                        <option value="">è¯·é€‰æ‹©ä¸“ä¸šæ–¹å‘</option>
                        <option value="è‚¿ç˜¤å†…ç§‘">è‚¿ç˜¤å†…ç§‘</option>
                        <option value="ä¹³è…ºå¤–ç§‘">ä¹³è…ºå¤–ç§‘</option>
                        <option value="èƒ¸å¤–ç§‘">èƒ¸å¤–ç§‘</option>
                        <option value="å‘¼å¸å†…ç§‘">å‘¼å¸å†…ç§‘</option>
                        <option value="ç—…ç†ç§‘">ç—…ç†ç§‘</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label" for="doctor-hospital">æ‰€åœ¨åŒ»é™¢</label>
                    <input type="text" id="doctor-hospital" class="form-control" placeholder="è¯·è¾“å…¥åŒ»é™¢åç§°">
                </div>

                <button type="button" class="btn btn-primary" onclick="nextStep()">ä¸‹ä¸€æ­¥</button>
            </div>

            <!-- ç¬¬äºŒæ­¥ï¼šç™»å½•è®¾ç½® -->
            <div class="form-step" id="login-step2">
                <h3 style="margin-bottom: 1.5rem;">ç™»å½•è®¾ç½®</h3>
                
                <div class="form-group">
                    <label class="form-label" for="username">ç”¨æˆ·å *</label>
                    <input type="text" id="username" class="form-control" placeholder="è¯·è®¾ç½®ç”¨æˆ·åï¼ˆå»ºè®®ä½¿ç”¨å§“åæ‹¼éŸ³ï¼‰" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="password">å¯†ç  *</label>
                    <input type="password" id="password" class="form-control" placeholder="è¯·è®¾ç½®å¯†ç ï¼ˆä¸å°‘äº6ä½ï¼‰" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="confirm-password">ç¡®è®¤å¯†ç  *</label>
                    <input type="password" id="confirm-password" class="form-control" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç " required>
                </div>

                <div style="display: flex; gap: 1rem;">
                    <button type="button" class="btn btn-secondary" onclick="prevStep()">ä¸Šä¸€æ­¥</button>
                    <button type="button" class="btn btn-success" onclick="completeRegistration()">å®Œæˆæ³¨å†Œ</button>
                </div>

                <div style="margin-top: 2rem; text-align: center; color: #666; font-size: 0.9rem;">
                    å·²æœ‰è´¦å·ï¼Ÿ<a href="#" onclick="showLogin()" style="color: #667eea;">ç›´æ¥ç™»å½•</a>
                </div>
            </div>

            <!-- ç›´æ¥ç™»å½•è¡¨å• -->
            <div class="form-step" id="direct-login">
                <h3 style="margin-bottom: 1.5rem;">ç”¨æˆ·ç™»å½•</h3>
                
                <div class="form-group">
                    <label class="form-label" for="login-username">ç”¨æˆ·å</label>
                    <input type="text" id="login-username" class="form-control" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                </div>

                <div class="form-group">
                    <label class="form-label" for="login-password">å¯†ç </label>
                    <input type="password" id="login-password" class="form-control" placeholder="è¯·è¾“å…¥å¯†ç ">
                </div>

                <button type="button" class="btn btn-primary" onclick="directLogin()">ç™»å½•</button>

                <div style="margin-top: 2rem; text-align: center; color: #666; font-size: 0.9rem;">
                    é¦–æ¬¡ä½¿ç”¨ï¼Ÿ<a href="#" onclick="showRegistration()" style="color: #667eea;">æ³¨å†Œè´¦å·</a>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸»ç•Œé¢ -->
    <div id="main-app" style="display: none;">
        <header class="header">
            <nav class="nav">
                <div class="logo">AIè¯ç‰©ååº”é¢„æµ‹è¯„ä¼°ç³»ç»Ÿ</div>
                <div class="nav-buttons">
                    <!-- ç®¡ç†å‘˜èœå• -->
                    <div id="admin-nav" style="display: none;">
                        <button class="nav-btn active" onclick="showPage('admin')">ç®¡ç†ç•Œé¢</button>
                        <button class="nav-btn" onclick="showPage('results')">ç»“æœç»Ÿè®¡</button>
                    </div>
                    <!-- æ™®é€šç”¨æˆ·èœå• -->
                    <button class="nav-btn active" onclick="showPage('surveys')">é—®å·å¡«å†™</button>
                </div>
                <div class="user-info">
                    <div class="user-avatar" id="user-avatar"></div>
                    <div>
                        <div id="user-name" style="font-weight: bold;"></div>
                        <div id="user-title" style="font-size: 0.8rem;"></div>
                    </div>
                    <button class="logout-btn" onclick="logout()">é€€å‡º</button>
                </div>
            </nav>
        </header>

        <div class="container">
            <!-- ç®¡ç†ç•Œé¢ (ä»…ç®¡ç†å‘˜å¯è§) -->
            <div id="admin" class="page active">
                <div class="page-header">
                    <h1>é—®å·ç®¡ç†ç³»ç»Ÿ</h1>
                    <p>ä¸Šä¼ å’Œç®¡ç†ä¸´åºŠè¯„ä¼°é—®å·</p>
                </div>
                <div class="page-content">
                    <div class="disease-tabs">
                        <button class="disease-tab active" onclick="switchDiseaseTab('breast_cancer', this)">ä¹³è…ºç™Œ</button>
                        <button class="disease-tab" onclick="switchDiseaseTab('lung_cancer', this)">éå°ç»†èƒè‚ºç™Œ</button>
                    </div>

                    <div id="breast_cancer_content" class="disease-content">
                        <div class="upload-area" onclick="document.getElementById('breast-upload').click()">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“‹</div>
                            <h3>ä¸Šä¼ ä¹³è…ºç™Œé—®å·æ–‡ä»¶</h3>
                            <p>æ”¯æŒ .md, .txt, .json æ ¼å¼ï¼Œç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ </p>
                            <input type="file" id="breast-upload" accept=".md,.txt,.json" multiple style="display: none;">
                        </div>
                        <div id="breast-surveys" class="survey-grid"></div>
                    </div>

                    <div id="lung_cancer_content" class="disease-content" style="display: none;">
                        <div class="upload-area" onclick="document.getElementById('lung-upload').click()">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“‹</div>
                            <h3>ä¸Šä¼ éå°ç»†èƒè‚ºç™Œé—®å·æ–‡ä»¶</h3>
                            <p>æ”¯æŒ .md, .txt, .json æ ¼å¼ï¼Œç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ </p>
                            <button class="btn btn-primary" style="margin-top: 1rem;" onclick="event.stopPropagation(); createTestSurvey('lung_cancer')">åˆ›å»ºæµ‹è¯•é—®å·</button>
                            <input type="file" id="lung-upload" accept=".md,.txt,.json" multiple style="display: none;">
                        </div>
                        <div id="lung-surveys" class="survey-grid"></div>
                    </div>
                </div>
            </div>

            <!-- é—®å·å¡«å†™ç•Œé¢ -->
            <div id="surveys" class="page">
                <div class="welcome-message">
                    <h2 id="welcome-text">æ¬¢è¿ï¼Œä¸“å®¶åŒ»ç”Ÿï¼</h2>
                    <p>æ„Ÿè°¢æ‚¨å‚ä¸AIè¯ç‰©ååº”é¢„æµ‹æ¨¡å‹çš„è¯„ä¼°å·¥ä½œ</p>
                </div>
                
                <div class="page-content">
                    <div class="disease-tabs">
                        <button class="disease-tab active" onclick="switchSurveyTab('breast', this)">ä¹³è…ºç™Œ (3)</button>
                        <button class="disease-tab" onclick="switchSurveyTab('lung', this)">éå°ç»†èƒè‚ºç™Œ (2)</button>
                    </div>

                    <div id="breast-survey-list" class="survey-content">
                        <div class="survey-grid">
                            <!-- ç¤ºä¾‹é—®å·å¡ç‰‡ -->
                            <div class="survey-card" onclick="openSurvey('P-0000597')">
                                <div class="card-header">
                                    <div class="card-title">ç—…ä¾‹ 32</div>
                                    <div class="card-status status-pending">å¾…å®Œæˆ</div>
                                </div>
                                <div class="card-info">
                                    <strong>æ‚£è€…ID:</strong> P-0000597<br>
                                    <strong>æ²»ç–—è¯ç‰©:</strong> å¡åŸ¹ä»–æ»¨<br>
                                    <strong>æ€§åˆ«:</strong> å¥³æ€§ | <strong>å¹´é¾„:</strong> 51å²<br>
                                    <strong>åˆ†æœŸ:</strong> IVæœŸ
                                </div>
                            </div>
                            
                            <div class="survey-card completed">
                                <div class="card-header">
                                    <div class="card-title">ç—…ä¾‹ 28</div>
                                    <div class="card-status status-completed">å·²å®Œæˆ</div>
                                </div>
                                <div class="card-info">
                                    <strong>æ‚£è€…ID:</strong> P-0000523<br>
                                    <strong>æ²»ç–—è¯ç‰©:</strong> å¤šè¥¿ä»–èµ›<br>
                                    <strong>æ€§åˆ«:</strong> å¥³æ€§ | <strong>å¹´é¾„:</strong> 45å²<br>
                                    <strong>åˆ†æœŸ:</strong> IIIæœŸ
                                </div>
                            </div>
                            
                            <div class="survey-card">
                                <div class="card-header">
                                    <div class="card-title">ç—…ä¾‹ 15</div>
                                    <div class="card-status status-pending">å¾…å®Œæˆ</div>
                                </div>
                                <div class="card-info">
                                    <strong>æ‚£è€…ID:</strong> P-0000341<br>
                                    <strong>æ²»ç–—è¯ç‰©:</strong> æ›²å¦¥ç å•æŠ—<br>
                                    <strong>æ€§åˆ«:</strong> å¥³æ€§ | <strong>å¹´é¾„:</strong> 62å²<br>
                                    <strong>åˆ†æœŸ:</strong> IIæœŸ
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="lung-survey-list" class="survey-content" style="display: none;">
                        <div class="survey-grid">
                            <div class="survey-card">
                                <div class="card-header">
                                    <div class="card-title">ç—…ä¾‹ 8</div>
                                    <div class="card-status status-pending">å¾…å®Œæˆ</div>
                                </div>
                                <div class="card-info">
                                    <strong>æ‚£è€…ID:</strong> P-0000201<br>
                                    <strong>æ²»ç–—è¯ç‰©:</strong> å¥¥å¸Œæ›¿å°¼<br>
                                    <strong>æ€§åˆ«:</strong> ç”·æ€§ | <strong>å¹´é¾„:</strong> 58å²<br>
                                    <strong>åˆ†æœŸ:</strong> IVæœŸ
                                </div>
                            </div>
                            
                            <div class="survey-card">
                                <div class="card-header">
                                    <div class="card-title">ç—…ä¾‹ 12</div>
                                    <div class="card-status status-pending">å¾…å®Œæˆ</div>
                                </div>
                                <div class="card-info">
                                    <strong>æ‚£è€…ID:</strong> P-0000287<br>
                                    <strong>æ²»ç–—è¯ç‰©:</strong> åŸ¹ç¾æ›²å¡<br>
                                    <strong>æ€§åˆ«:</strong> å¥³æ€§ | <strong>å¹´é¾„:</strong> 65å²<br>
                                    <strong>åˆ†æœŸ:</strong> IIIæœŸ
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å…·ä½“é—®å·å¡«å†™ -->
            <div id="survey-detail" class="page">
                <div class="page-header">
                    <h1>ç—…ä¾‹ 32 - è¯ç‰©ååº”é¢„æµ‹è¯„ä¼°</h1>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>
                <div class="page-content">
                    <button class="btn btn-primary" onclick="showPage('surveys')" style="margin-bottom: 2rem;">â† è¿”å›é—®å·åˆ—è¡¨</button>
                    
                    <!-- æ‚£è€…ä¿¡æ¯ -->
                    <div class="patient-info">
                        <h3 style="margin-bottom: 1rem;">æ‚£è€…ä¸´åºŠä¿¡æ¯æ‘˜è¦</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <div class="info-label">æ‚£è€…ID</div>
                                <div class="info-value">P-0000597</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">æ²»ç–—è¯ç‰©</div>
                                <div class="info-value">å¡åŸ¹ä»–æ»¨ (CAPECITABINE)</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">æ€§åˆ«</div>
                                <div class="info-value">å¥³æ€§</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">å¹´é¾„</div>
                                <div class="info-value">51.0</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">ç§æ—</div>
                                <div class="info-value">é»‘äººæˆ–éè£”ç¾å›½äºº</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">å¸çƒŸå²</div>
                                <div class="info-value">ä»ä¸å¸çƒŸ</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">è¯Šæ–­</div>
                                <div class="info-value">æµ¸æ¶¦æ€§å¯¼ç®¡ç™Œ | ä¹³è…ºï¼Œå¤–ä¸Šè±¡é™</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">HRçŠ¶æ€</div>
                                <div class="info-value">é˜³æ€§</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">HER2çŠ¶æ€</div>
                                <div class="info-value">é˜´æ€§</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">æœ€é«˜è®°å½•åˆ†æœŸ</div>
                                <div class="info-value">IVæœŸ</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">TMB (éåŒä¹‰çªå˜)</div>
                                <div class="info-value">7.76</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">å…³é”®åŸºå› çªå˜</div>
                                <div class="info-value">TNFAIP3 p.L12M, KMT2C p.S4151F, PTPRD p.M1253K, GATA3 p.L190P, ARID2 p.I486V, BRCA2 p.R2268K, BRCA2 p.L1491Kfs*12</div>
                            </div>
                        </div>
                    </div>

                    <form id="survey-form">
                        <!-- ç¬¬ä¸€éƒ¨åˆ†ï¼šä¸´åºŠé¢„æµ‹ -->
                        <div class="section-title">ç¬¬ä¸€éƒ¨åˆ†ï¼šæ¨¡å‹æ€§èƒ½è¯„ä¼° - ä¸´åºŠé¢„æµ‹</div>
                        
                        <div class="form-group">
                            <div class="form-label">1.1 æ‚¨çš„é¢„æµ‹</div>
                            <p style="margin-bottom: 1rem;">åŸºäºä»¥ä¸Šæ‚£è€…ä¿¡æ¯ï¼Œè¯·æ ¹æ®æ‚¨çš„ä¸“ä¸šçŸ¥è¯†å’Œä¸´åºŠç»éªŒï¼Œæ¨æ–­è¯¥æ‚£è€…åœ¨ä½¿ç”¨å¡åŸ¹ä»–æ»¨æ²»ç–—åçš„è¯ç‰©ååº”æœ€å¯èƒ½å±äºå“ªä¸€ç±»ï¼Ÿ</p>
                            <div class="radio-group">
                                <label class="radio-item">
                                    <input type="radio" name="prediction" value="positive">
                                    <strong>ç§¯æå“åº”</strong> (CR+PR)
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="prediction" value="negative">
                                    <strong>æ¶ˆæå“åº”</strong> (SD+PD)
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="reasoning">1.2 æ‚¨çš„ä¸»è¦åˆ¤æ–­ä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆå¯é€‰ï¼‰</label>
                            <textarea class="form-control" id="reasoning" rows="4" placeholder="è¯·ç®€è¿°å½±å“æ‚¨åˆ¤æ–­çš„å…³é”®å› ç´ ï¼Œå¦‚ç‰¹å®šåŸºå› çªå˜ã€TMBçŠ¶æ€ã€æ—¢å¾€æ²»ç–—å²ç­‰"></textarea>
                        </div>

                        <!-- ç¬¬äºŒéƒ¨åˆ†ï¼šæ¨¡å‹è¾“å‡ºè´¨é‡è¯„ä¼° -->
                        <div class="section-title">ç¬¬äºŒéƒ¨åˆ†ï¼šæ¨¡å‹è¾“å‡ºæ–‡æœ¬è´¨é‡è¯„ä¼°</div>

                        <!-- æ¨¡å‹AæŠ¥å‘Š -->
                        <div class="model-report">
                            <div class="report-header" onclick="toggleReport('modelA')">
                                <h4>æ¨¡å‹Aï¼šç”Ÿæˆçš„æŠ¥å‘Š</h4>
                                <span id="modelA-toggle">å±•å¼€ â–¼</span>
                            </div>
                            <div class="report-content" id="modelA-content" style="display: none;">
                                <h4>ç²¾å‡†è‚¿ç˜¤å­¦æŠ¥å‘Š</h4>
                                <p><strong>é¢„æµ‹æ²»ç–—ååº”è¯„åˆ†ï¼š</strong> 0.420 / 1.0</p>
                                <p>ï¼ˆåˆ†æ•°è¶Šæ¥è¿‘1ï¼Œè¡¨ç¤ºç§¯æå“åº”çš„å¯èƒ½æ€§è¶Šé«˜ã€‚ï¼‰</p>
                                <h5>æ¨ç†ä¾æ®</h5>
                                <ol>
                                    <li><strong>BRCA2çªå˜ï¼š</strong> BRCA2 p.R2268Kå’ŒL1491Kfs*12çš„å­˜åœ¨å¯èƒ½é€šè¿‡å½±å“DNAä¿®å¤é€”å¾„è€Œå½±å“å¡åŸ¹ä»–æ»¨çš„ç–—æ•ˆã€‚çªå˜å¯¹åŒ–ç–—æ•æ„Ÿæ€§/è€è¯æ€§çš„ä½œç”¨å…·æœ‰å¤æ‚æ€§å’Œæƒ…å¢ƒä¾èµ–æ€§ã€‚</li>
                                    <li><strong>TMB (7.76)ï¼š</strong> ä¸­ç­‰åŸºå› ç»„ä¸ç¨³å®šæ€§ï¼›TMBå¯¹åŒ–ç–—ååº”çš„å½±å“å­˜åœ¨å˜å¼‚æ€§ã€‚</li>
                                    <li><strong>MSIçŠ¶æ€ï¼š</strong> MSIè¯„åˆ†ä¸º-1.0æç¤ºæœªæ£€æµ‹åˆ°å¾®å«æ˜Ÿä¸ç¨³å®šæ€§ï¼Œä½†å¾®å¦™çš„é”™é…ä¿®å¤æ”¹å˜ä»å¯èƒ½å½±å“è¯ç‰©ååº”ã€‚</li>
                                </ol>
                                <h5>å…³é”®ä¸´åºŠå†³å®šå› ç´ ï¼š</h5>
                                <ul>
                                    <li><strong>ä½“èƒ½çŠ¶æ€ï¼š</strong> æœªæ˜ç¡®ä½†å¯èƒ½å½±å“é¢„åï¼›è¾ƒå¥½çš„ä½“èƒ½çŠ¶æ€é€šå¸¸ä¸æ›´ä½³ç–—æ•ˆç›¸å…³ã€‚</li>
                                    <li><strong>æ—¢å¾€åŒ–ç–—æš´éœ²ï¼š</strong> æ—¢å¾€æ²»ç–—ï¼ˆå¦‚æ¥æ›²å”‘ã€ä»–è«æ˜”èŠ¬ï¼‰å¯èƒ½å¼•å…¥äº¤å‰è€è¯é£é™©ï¼Œä½†ä¸ªä½“ååº”å­˜åœ¨å·®å¼‚ã€‚</li>
                                </ul>
                            </div>
                        </div>

                        <!-- æ¨¡å‹BæŠ¥å‘Š -->
                        <div class="model-report">
                            <div class="report-header" onclick="toggleReport('modelB')">
                                <h4>æ¨¡å‹Bï¼šç”Ÿæˆçš„æŠ¥å‘Š</h4>
                                <span id="modelB-toggle">å±•å¼€ â–¼</span>
                            </div>
                            <div class="report-content" id="modelB-content" style="display: none;">
                                <h4>ç²¾å‡†è‚¿ç˜¤å­¦æŠ¥å‘Š</h4>
                                <p><strong>é¢„æµ‹æ²»ç–—ååº”è¯„åˆ†ï¼š</strong> 0.648 / 1.0</p>
                                <p>ï¼ˆåˆ†æ•°è¶Šæ¥è¿‘1ï¼Œè¡¨ç¤ºç§¯æå“åº”çš„å¯èƒ½æ€§è¶Šé«˜ã€‚ï¼‰</p>
                                <h5>æ¨ç†ä¾æ®</h5>
                                <ul>
                                    <li><strong>åŸºå› çªå˜ä¸è¯ç‰©æœºåˆ¶ï¼š</strong> å¡åŸ¹ä»–æ»¨ä»£è°¢ä¸º5-æ°Ÿå°¿å˜§å•¶ï¼ˆ5-FUï¼‰ï¼Œé€šè¿‡æŠ‘åˆ¶èƒ¸è‹·é…¸åˆæˆé…¶ï¼ˆTYMSï¼‰å¹²æ‰°DNAåˆæˆã€‚æ‚£è€…çš„BRCA2 p.R2268Kå’Œp.L1491Kfs*12çªå˜ä¸åŒæºé‡ç»„ç¼ºé™·ï¼ˆHRDï¼‰ç›¸å…³ï¼Œå¯èƒ½å› DNAä¿®å¤å—æŸè€Œå¢å¼ºå¯¹5-FUçš„æ•æ„Ÿæ€§ã€‚</li>
                                    <li><strong>ä¸´åºŠä¸ç”Ÿç‰©æ ‡å¿—ç‰©èƒŒæ™¯ï¼š</strong> æ‚£è€…ä¸ºIVæœŸHR+/HER2-ä¹³è…ºç™Œï¼ŒCEAå’ŒCA 15-3æ°´å¹³å‡é«˜æç¤ºç–¾ç—…è¿›å±•ã€‚æ—¢å¾€æ²»ç–—ï¼ˆå¦‚æ¥æ›²å”‘ã€å“ŒæŸè¥¿åˆ©ï¼‰è¡¨æ˜å­˜åœ¨å†…åˆ†æ³Œè€è¯ï¼Œå› æ­¤å¡åŸ¹ä»–æ»¨æ˜¯åˆç†é€‰æ‹©ã€‚</li>
                                    <li><strong>æ‚£è€…ç‰¹å¼‚æ€§å› ç´ ï¼š</strong> æ‚£è€…çš„éè£”ç¾å›½äººæ—è£”å¯èƒ½å½±å“è¯ç‰©ä»£è°¢ï¼ˆå¦‚ç¾§é…¸é…¯é…¶æ´»æ€§è¾ƒä½ï¼‰ï¼Œä»è€Œå¹²æ‰°å¡åŸ¹ä»–æ»¨å‘5-FUçš„è½¬åŒ–ã€‚</li>
                                </ul>
                            </div>
                        </div>

                        <!-- è¯„åˆ†è¡¨ -->
                        <div class="form-group">
                            <div class="form-label">2.1 è¯„åˆ†è¡¨</div>
                            <p>è¯·æ ¹æ®ä»¥ä¸‹ç»´åº¦å¯¹ä¸¤ä¸ªæ¨¡å‹çš„æŠ¥å‘Šè¿›è¡Œæ‰“åˆ† (1=éå¸¸å·®, 5=éå¸¸å¥½)</p>
                            
                            <table class="rating-table">
                                <thead>
                                    <tr>
                                        <th>è¯„ä¼°ç»´åº¦</th>
                                        <th>æ¨¡å‹A (1-5åˆ†)</th>
                                        <th>æ¨¡å‹B (1-5åˆ†)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <strong>å¯è¯»æ€§</strong><br>
                                            <small>æŠ¥å‘Šç»“æ„æ¸…æ™°ã€è¯­è¨€æµç•…ã€æ˜“äºç†è§£</small>
                                        </td>
                                        <td>
                                            <div class="rating-controls">
                                                <button type="button" class="rating-btn" onclick="setRating('readability_a', 1, this)">1</button>
                                                <button type="button" class="rating-btn" onclick="setRating('readability_a', 2, this)">2</button>
                                                <button type="button" class="rating-btn" onclick="setRating('readability_a', 3, this)">3</button>
                                                <button type="button" class="rating-btn" onclick="setRating('readability_a', 4, this)">4</button>
                                                <button type="button" class="rating-btn" onclick="setRating('readability_a', 5, this)">5</button>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="rating-controls">
                                                <button type="button" class="rating-btn" onclick="setRating('readability_b', 1, this)">1</button>
                                                <button type="button" class="rating-btn" onclick="setRating('readability_b', 2, this)">2</button>
                                                <button type="button" class="rating-btn" onclick="setRating('readability_b', 3, this)">3</button>
                                                <button type="button" class="rating-btn" onclick="setRating('readability_b', 4, this)">4</button>
                                                <button type="button" class="rating-btn" onclick="setRating('readability_b', 5, this)">5</button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <strong>ä¿¡æ¯å®Œæ•´æ€§</strong><br>
                                            <small>å…³é”®ä¸´åºŠå’ŒåŸºå› ä¿¡æ¯çš„å‘ˆç°æ˜¯å¦å…¨é¢</small>
                                        </td>
                                        <td>
                                            <div class="rating-controls">
                                                <button type="button" class="rating-btn" onclick="setRating('completeness_a', 1, this)">1</button>
                                                <button type="button" class="rating-btn" onclick="setRating('completeness_a', 2, this)">2</button>
                                                <button type="button" class="rating-btn" onclick="setRating('completeness_a', 3, this)">3</button>
                                                <button type="button" class="rating-btn" onclick="setRating('completeness_a', 4, this)">4</button>
                                                <button type="button" class="rating-btn" onclick="setRating('completeness_a', 5, this)">5</button>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="rating-controls">
                                                <button type="button" class="rating-btn" onclick="setRating('completeness_b', 1, this)">1</button>
                                                <button type="button" class="rating-btn" onclick="setRating('completeness_b', 2, this)">2</button>
                                                <button type="button" class="rating-btn" onclick="setRating('completeness_b', 3, this)">3</button>
                                                <button type="button" class="rating-btn" onclick="setRating('completeness_b', 4, this)">4</button>
                                                <button type="button" class="rating-btn" onclick="setRating('completeness_b', 5, this)">5</button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <strong>æ¨ç†é€»è¾‘æ€§</strong><br>
                                            <small>AIåˆ†æéƒ¨åˆ†çš„é€»è¾‘é“¾æ¡æ˜¯å¦æ¸…æ™°ã€ä¸¥è°¨ã€æœ‰è¯´æœåŠ›</small>
                                        </td>
                                        <td>
                                            <div class="rating-controls">
                                                <button type="button" class="rating-btn" onclick="setRating('logic_a', 1, this)">1</button>
                                                <button type="button" class="rating-btn" onclick="setRating('logic_a', 2, this)">2</button>
                                                <button type="button" class="rating-btn" onclick="setRating('logic_a', 3, this)">3</button>
                                                <button type="button" class="rating-btn" onclick="setRating('logic_a', 4, this)">4</button>
                                                <button type="button" class="rating-btn" onclick="setRating('logic_a', 5, this)">5</button>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="rating-controls">
                                                <button type="button" class="rating-btn" onclick="setRating('logic_b', 1, this)">1</button>
                                                <button type="button" class="rating-btn" onclick="setRating('logic_b', 2, this)">2</button>
                                                <button type="button" class="rating-btn" onclick="setRating('logic_b', 3, this)">3</button>
                                                <button type="button" class="rating-btn" onclick="setRating('logic_b', 4, this)">4</button>
                                                <button type="button" class="rating-btn" onclick="setRating('logic_b', 5, this)">5</button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <strong>ä¸´åºŠæ´å¯ŸåŠ›</strong><br>
                                            <small>æ¨ç†æ˜¯å¦ç»“åˆäº†æ·±åº¦çš„ä¸´åºŠèƒŒæ™¯å’Œè¯ç‰©æœºåˆ¶çŸ¥è¯†</small>
                                        </td>
                                        <td>
                                            <div class="rating-controls">
                                                <button type="button" class="rating-btn" onclick="setRating('insight_a', 1, this)">1</button>
                                                <button type="button" class="rating-btn" onclick="setRating('insight_a', 2, this)">2</button>
                                                <button type="button" class="rating-btn" onclick="setRating('insight_a', 3, this)">3</button>
                                                <button type="button" class="rating-btn" onclick="setRating('insight_a', 4, this)">4</button>
                                                <button type="button" class="rating-btn" onclick="setRating('insight_a', 5, this)">5</button>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="rating-controls">
                                                <button type="button" class="rating-btn" onclick="setRating('insight_b', 1, this)">1</button>
                                                <button type="button" class="rating-btn" onclick="setRating('insight_b', 2, this)">2</button>
                                                <button type="button" class="rating-btn" onclick="setRating('insight_b', 3, this)">3</button>
                                                <button type="button" class="rating-btn" onclick="setRating('insight_b', 4, this)">4</button>
                                                <button type="button" class="rating-btn" onclick="setRating('insight_b', 5, this)">5</button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <strong>ä¸´åºŠå®ç”¨æ€§</strong><br>
                                            <small>æŠ¥å‘Šåœ¨å¤šå¤§ç¨‹åº¦ä¸Šèƒ½è¾…åŠ©å®é™…çš„ä¸´åºŠå†³ç­–</small>
                                        </td>
                                        <td>
                                            <div class="rating-controls">
                                                <button type="button" class="rating-btn" onclick="setRating('utility_a', 1, this)">1</button>
                                                <button type="button" class="rating-btn" onclick="setRating('utility_a', 2, this)">2</button>
                                                <button type="button" class="rating-btn" onclick="setRating('utility_a', 3, this)">3</button>
                                                <button type="button" class="rating-btn" onclick="setRating('utility_a', 4, this)">4</button>
                                                <button type="button" class="rating-btn" onclick="setRating('utility_a', 5, this)">5</button>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="rating-controls">
                                                <button type="button" class="rating-btn" onclick="setRating('utility_b', 1, this)">1</button>
                                                <button type="button" class="rating-btn" onclick="setRating('utility_b', 2, this)">2</button>
                                                <button type="button" class="rating-btn" onclick="setRating('utility_b', 3, this)">3</button>
                                                <button type="button" class="rating-btn" onclick="setRating('utility_b', 4, this)">4</button>
                                                <button type="button" class="rating-btn" onclick="setRating('utility_b', 5, this)">5</button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <strong>æ€»ä½“å¯ä¿¡åº¦</strong><br>
                                            <small>æ‚¨åœ¨å¤šå¤§ç¨‹åº¦ä¸Šä¿¡ä»»è¯¥æŠ¥å‘Šçš„ç»“è®ºå’Œæ¨ç†è¿‡ç¨‹</small>
                                        </td>
                                        <td>
                                            <div class="rating-controls">
                                                <button type="button" class="rating-btn" onclick="setRating('trust_a', 1, this)">1</button>
                                                <button type="button" class="rating-btn" onclick="setRating('trust_a', 2, this)">2</button>
                                                <button type="button" class="rating-btn" onclick="setRating('trust_a', 3, this)">3</button>
                                                <button type="button" class="rating-btn" onclick="setRating('trust_a', 4, this)">4</button>
                                                <button type="button" class="rating-btn" onclick="setRating('trust_a', 5, this)">5</button>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="rating-controls">
                                                <button type="button" class="rating-btn" onclick="setRating('trust_b', 1, this)">1</button>
                                                <button type="button" class="rating-btn" onclick="setRating('trust_b', 2, this)">2</button>
                                                <button type="button" class="rating-btn" onclick="setRating('trust_b', 3, this)">3</button>
                                                <button type="button" class="rating-btn" onclick="setRating('trust_b', 4, this)">4</button>
                                                <button type="button" class="rating-btn" onclick="setRating('trust_b', 5, this)">5</button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- ç»¼åˆåå¥½ -->
                        <div class="form-group">
                            <div class="form-label">2.2 ç»¼åˆåå¥½</div>
                            <p>æ€»ä½“è€Œè¨€ï¼Œå¦‚æœè¦åœ¨ä¸´åºŠå·¥ä½œä¸­ä½¿ç”¨ï¼Œæ‚¨æ›´åå¥½å“ªä¸ªæ¨¡å‹çš„æŠ¥å‘Šï¼Ÿ</p>
                            <div class="radio-group">
                                <label class="radio-item">
                                    <input type="radio" name="preference" value="model_a">
                                    <strong>æ¨¡å‹ A</strong>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="preference" value="model_b">
                                    <strong>æ¨¡å‹ B</strong>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="preference" value="no_difference">
                                    <strong>ä¸¤è€…æ— æ˜æ˜¾å·®å¼‚</strong>
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="preference-reason">2.3 è¯·ç®€è¦è¯´æ˜æ‚¨åšå‡ºåå¥½é€‰æ‹©çš„ç†ç”±ï¼ˆå¯é€‰ï¼‰</label>
                            <textarea class="form-control" id="preference-reason" rows="4" placeholder="è¯·è¯´æ˜æ‚¨çš„é€‰æ‹©ç†ç”±"></textarea>
                        </div>

                        <!-- å…¶ä»–åé¦ˆ -->
                        <div class="form-group">
                            <label class="form-label" for="additional-feedback">æ‚¨çš„å®è´µæ„è§ï¼ˆå¯é€‰ï¼‰</label>
                            <textarea class="form-control" id="additional-feedback" rows="4" placeholder="å¦‚æœæ‚¨å¯¹æœ¬æ¬¡è¯„ä¼°æˆ–AIæ¨¡å‹æœ‰ä»»ä½•é¢å¤–çš„å»ºè®®æˆ–åé¦ˆï¼Œè¯·åœ¨æ­¤å¤„å¡«å†™"></textarea>
                        </div>

                        <div style="text-align: center; margin-top: 2rem;">
                            <button type="button" class="btn btn-success" onclick="submitSurvey()">æäº¤é—®å·</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- ç»“æœç»Ÿè®¡ (ä»…ç®¡ç†å‘˜å¯è§) -->
            <div id="results" class="page">
                <div class="page-header">
                    <h1>è¯„ä¼°ç»“æœç»Ÿè®¡</h1>
                    <p>æŸ¥çœ‹é—®å·æ”¶é›†ç»“æœå’Œæ•°æ®åˆ†æ</p>
                </div>
                <div class="page-content">
                    <div class="disease-tabs">
                        <button class="disease-tab active">æ€»ä½“ç»Ÿè®¡</button>
                        <button class="disease-tab">ä¹³è…ºç™Œ</button>
                        <button class="disease-tab">éå°ç»†èƒè‚ºç™Œ</button>
                    </div>

                    <div class="stats-grid" id="stats-container">
                        <!-- ç»Ÿè®¡æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                    </div>

                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <button class="btn btn-primary" onclick="exportResults()">å¯¼å‡ºç»“æœæ•°æ®</button>
                        <button class="btn btn-secondary" onclick="clearAllData()">æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        const userData = {
            currentUser: null,
            users: [
                // é¢„è®¾ç®¡ç†å‘˜è´¦æˆ·
                {
                    username: 'admin',
                    password: 'admin123',
                    name: 'ç³»ç»Ÿç®¡ç†å‘˜',
                    title: 'ç®¡ç†å‘˜',
                    role: 'admin'
                }
            ]
        };

        const surveyData = {
            ratings: {},
            surveys: {
                breast_cancer: [],
                lung_cancer: []
            }
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            checkLogin();
            initFileUpload();
            
            // ç›‘å¬è¡¨å•å˜åŒ–
            document.addEventListener('change', (e) => {
                if (e.target.type === 'radio') {
                    updateProgress();
                }
            });
        });

        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        function checkLogin() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                userData.currentUser = JSON.parse(savedUser);
                showMainApp();
            } else {
                showLogin();
            }
        }

        // æ˜¾ç¤ºä¸»åº”ç”¨
        function showMainApp() {
            document.getElementById('login-container').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            
            const user = userData.currentUser;
            
            // æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º
            document.getElementById('user-avatar').textContent = user.name.charAt(0);
            document.getElementById('user-name').textContent = user.name;
            document.getElementById('user-title').textContent = user.title + (user.specialty ? ' | ' + user.specialty : '');
            document.getElementById('welcome-text').textContent = `æ¬¢è¿ï¼Œ${user.name} ${user.title}ï¼`;
            
            // æ ¹æ®è§’è‰²æ˜¾ç¤ºä¸åŒåŠŸèƒ½
            if (user.role === 'admin') {
                document.getElementById('admin-nav').style.display = 'flex';
                showPage('admin');
                // é¢„åŠ è½½ç»Ÿè®¡æ•°æ®å’Œä¸Šä¼ çš„é—®å·
                loadStatistics();
                loadUploadedSurveys();
            } else {
                document.getElementById('admin-nav').style.display = 'none';
                showPage('surveys');
            }
        }

        // åŠ è½½å·²ä¸Šä¼ çš„é—®å·
        function loadUploadedSurveys() {
            const surveys = JSON.parse(localStorage.getItem('uploadedSurveys') || '[]');
            
            // æ¸…ç©ºç°æœ‰æ˜¾ç¤º
            const breastContainer = document.querySelector('#breast-surveys');
            const lungContainer = document.querySelector('#lung-surveys');
            if (breastContainer) breastContainer.innerHTML = '';
            if (lungContainer) lungContainer.innerHTML = '';
            
            // æ˜¾ç¤ºæ‰€æœ‰ä¸Šä¼ çš„é—®å·
            surveys.forEach(survey => {
                displayUploadedSurvey(survey, survey.diseaseType);
            });
            
            // å¦‚æœæ²¡æœ‰ä¸Šä¼ çš„é—®å·ï¼Œæ˜¾ç¤ºæç¤º
            if (surveys.length === 0) {
                [breastContainer, lungContainer].forEach(container => {
                    if (container) {
                        container.innerHTML = `
                            <div style="text-align: center; padding: 2rem; color: #666;">
                                <p>æš‚æ— ä¸Šä¼ çš„é—®å·</p>
                                <p style="font-size: 0.9rem;">è¯·ç‚¹å‡»ä¸Šæ–¹çš„ä¸Šä¼ åŒºåŸŸæ·»åŠ é—®å·æ–‡ä»¶</p>
                            </div>
                        `;
                    }
                });
            }
        }

        // æ˜¾ç¤ºç™»å½•ç•Œé¢
        function showLogin() {
            document.getElementById('login-container').style.display = 'block';
            document.getElementById('main-app').style.display = 'none';
        }

        // æ³¨å†Œæ­¥éª¤æ§åˆ¶
        let currentStep = 1;

        function nextStep() {
            // éªŒè¯ç¬¬ä¸€æ­¥è¡¨å•
            const name = document.getElementById('doctor-name').value;
            const title = document.getElementById('doctor-title').value;
            const experience = document.getElementById('doctor-experience').value;
            const specialty = document.getElementById('doctor-specialty').value;
            
            if (!name || !title || !experience || !specialty) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹ï¼');
                return;
            }
            
            // åˆ‡æ¢åˆ°ç¬¬äºŒæ­¥
            document.getElementById('login-step1').classList.remove('active');
            document.getElementById('login-step2').classList.add('active');
            document.getElementById('step1').classList.remove('active');
            document.getElementById('step1').classList.add('completed');
            document.getElementById('step2').classList.add('active');
            currentStep = 2;
        }

        function prevStep() {
            document.getElementById('login-step2').classList.remove('active');
            document.getElementById('login-step1').classList.add('active');
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step1').classList.remove('completed');
            document.getElementById('step1').classList.add('active');
            currentStep = 1;
        }

        function showRegistration() {
            document.getElementById('direct-login').classList.remove('active');
            document.getElementById('login-step1').classList.add('active');
            // é‡ç½®æ­¥éª¤æŒ‡ç¤ºå™¨
            document.getElementById('step1').classList.add('active');
            document.getElementById('step2').classList.remove('active', 'completed');
            currentStep = 1;
        }

        function showLogin() {
            document.getElementById('login-step1').classList.remove('active');
            document.getElementById('login-step2').classList.remove('active');
            document.getElementById('direct-login').classList.add('active');
        }

        // å®Œæˆæ³¨å†Œ
        function completeRegistration() {
            // è·å–æ‰€æœ‰è¡¨å•æ•°æ®
            const userData = {
                name: document.getElementById('doctor-name').value,
                title: document.getElementById('doctor-title').value,
                experience: document.getElementById('doctor-experience').value,
                specialty: document.getElementById('doctor-specialty').value,
                hospital: document.getElementById('doctor-hospital').value,
                username: document.getElementById('username').value,
                password: document.getElementById('password').value,
                confirmPassword: document.getElementById('confirm-password').value,
                role: 'doctor', // æ™®é€šåŒ»ç”Ÿè§’è‰²
                registrationTime: new Date().toISOString()
            };
            
            // éªŒè¯æ•°æ®
            if (!userData.name || !userData.title || !userData.experience || 
                !userData.specialty || !userData.username || !userData.password) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹ï¼');
                return;
            }
            
            if (userData.password !== userData.confirmPassword) {
                alert('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´ï¼');
                return;
            }
            
            if (userData.password.length < 6) {
                alert('å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½ï¼');
                return;
            }
            
            // æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
            const existingUsers = JSON.parse(localStorage.getItem('users') || '[]');
            if (existingUsers.some(user => user.username === userData.username)) {
                alert('ç”¨æˆ·åå·²å­˜åœ¨ï¼Œè¯·é€‰æ‹©å…¶ä»–ç”¨æˆ·åï¼');
                return;
            }
            
            // ä¿å­˜ç”¨æˆ·æ•°æ®
            existingUsers.push(userData);
            localStorage.setItem('users', JSON.stringify(existingUsers));
            
            // è‡ªåŠ¨ç™»å½•
            const currentUser = {
                username: userData.username,
                name: userData.name,
                title: userData.title,
                specialty: userData.specialty,
                experience: userData.experience,
                hospital: userData.hospital,
                role: userData.role
            };
            
            userData.currentUser = currentUser;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            alert('æ³¨å†ŒæˆåŠŸï¼æ¬¢è¿ä½¿ç”¨AIè¯ç‰©ååº”é¢„æµ‹è¯„ä¼°ç³»ç»Ÿã€‚');
            showMainApp();
        }

        // ç›´æ¥ç™»å½•
        function directLogin() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            
            if (!username || !password) {
                alert('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼');
                return;
            }
            
            // æ£€æŸ¥ç”¨æˆ·
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            
            // æ·»åŠ ç®¡ç†å‘˜è´¦æˆ·åˆ°æ£€æŸ¥åˆ—è¡¨
            const allUsers = [
                {
                    username: 'admin',
                    password: 'admin123',
                    name: 'ç³»ç»Ÿç®¡ç†å‘˜',
                    title: 'ç®¡ç†å‘˜',
                    role: 'admin'
                },
                ...users
            ];
            
            const user = allUsers.find(u => u.username === username && u.password === password);
            
            if (user) {
                const currentUser = {
                    username: user.username,
                    name: user.name,
                    title: user.title,
                    specialty: user.specialty,
                    experience: user.experience,
                    hospital: user.hospital,
                    role: user.role
                };
                
                userData.currentUser = currentUser;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showMainApp();
            } else {
                alert('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼');
            }
        }

        // é€€å‡ºç™»å½•
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                userData.currentUser = null;
                localStorage.removeItem('currentUser');
                showLogin();
                
                // é‡ç½®è¡¨å•
                document.getElementById('login-username').value = '';
                document.getElementById('login-password').value = '';
            }
        }

        // åˆ›å»ºæµ‹è¯•é—®å·
        function createTestSurvey(diseaseType) {
            if (userData.currentUser.role !== 'admin') {
                alert('åªæœ‰ç®¡ç†å‘˜å¯ä»¥åˆ›å»ºæµ‹è¯•é—®å·ï¼');
                return;
            }
            
            const testSurveys = {
                breast_cancer: {
                    title: "ç—…ä¾‹ 32",
                    caseNumber: "32",
                    patientId: "P-0000597",
                    drug: "å¡åŸ¹ä»–æ»¨ (CAPECITABINE)",
                    patientInfo: {
                        gender: "å¥³æ€§",
                        age: "51.0",
                        race: "é»‘äººæˆ–éè£”ç¾å›½äºº",
                        smoking: "ä»ä¸å¸çƒŸ",
                        diagnosis: "æµ¸æ¶¦æ€§å¯¼ç®¡ç™Œ | ä¹³è…ºï¼Œå¤–ä¸Šè±¡é™ (M8500/3 | C504)",
                        stage: "IVæœŸ",
                        tmb: "7.76",
                        mutations: "TNFAIP3 p.L12M, KMT2C p.S4151F, PTPRD p.M1253K, GATA3 p.L190P, ARID2 p.I486V, BRCA2 p.R2268K, BRCA2 p.L1491Kfs*12"
                    },
                    modelReports: {
                        modelA: "é¢„æµ‹æ²»ç–—ååº”è¯„åˆ†: 0.420 / 1.0\næ¨ç†ä¾æ®:\n1. BRCA2çªå˜: å¯èƒ½é€šè¿‡å½±å“DNAä¿®å¤é€”å¾„è€Œå½±å“å¡åŸ¹ä»–æ»¨çš„ç–—æ•ˆ\n2. TMB (7.76): ä¸­ç­‰åŸºå› ç»„ä¸ç¨³å®šæ€§",
                        modelB: "é¢„æµ‹æ²»ç–—ååº”è¯„åˆ†: 0.648 / 1.0\næ¨ç†ä¾æ®:\nåŸºå› çªå˜ä¸è¯ç‰©æœºåˆ¶: å¡åŸ¹ä»–æ»¨ä»£è°¢ä¸º5-æ°Ÿå°¿å˜§å•¶ï¼Œæ‚£è€…çš„BRCA2çªå˜å¯èƒ½å¢å¼ºå¯¹5-FUçš„æ•æ„Ÿæ€§"
                    }
                },
                lung_cancer: {
                    title: "ç—…ä¾‹ 8",
                    caseNumber: "8",
                    patientId: "P-0000201",
                    drug: "å¥¥å¸Œæ›¿å°¼ (OSIMERTINIB)",
                    patientInfo: {
                        gender: "ç”·æ€§",
                        age: "58",
                        race: "äºšæ´²äºº",
                        smoking: "æ—¢å¾€å¸çƒŸ",
                        diagnosis: "è‚ºè…ºç™Œ",
                        stage: "IVæœŸ",
                        tmb: "4.2",
                        mutations: "EGFR T790M, EGFR L858R"
                    },
                    modelReports: {
                        modelA: "é¢„æµ‹æ²»ç–—ååº”è¯„åˆ†: 0.85 / 1.0\nEGFR T790Mçªå˜å¯¹å¥¥å¸Œæ›¿å°¼æ•æ„Ÿ",
                        modelB: "é¢„æµ‹æ²»ç–—ååº”è¯„åˆ†: 0.78 / 1.0\nä¸‰ä»£EGFR-TKIå¯¹T790Mçªå˜æœ‰å¾ˆå¥½çš„ç–—æ•ˆ"
                    }
                }
            };
            
            const survey = testSurveys[diseaseType];
            if (survey) {
                // æ·»åŠ ç³»ç»Ÿå­—æ®µ
                survey.id = Date.now() + '_test_' + Math.random().toString(36).substr(2, 9);
                survey.diseaseType = diseaseType;
                survey.uploadTime = new Date().toISOString();
                survey.fileName = `test_${diseaseType}_${survey.caseNumber}.json`;
                
                // ä¿å­˜åˆ°localStorage
                const existingSurveys = JSON.parse(localStorage.getItem('uploadedSurveys') || '[]');
                existingSurveys.push(survey);
                localStorage.setItem('uploadedSurveys', JSON.stringify(existingSurveys));
                
                // æ›´æ–°æ˜¾ç¤º
                displayUploadedSurvey(survey, diseaseType);
                loadStatistics();
                
                alert(`æµ‹è¯•é—®å·"${survey.title}"åˆ›å»ºæˆåŠŸï¼`);
            }
        }
        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰ä¸Šä¼ çš„é—®å·å’Œå¡«å†™ç»“æœï¼\n\næ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                if (confirm('è¯·å†æ¬¡ç¡®è®¤ï¼šæ‚¨çœŸçš„è¦åˆ é™¤æ‰€æœ‰æ•°æ®å—ï¼Ÿ')) {
                    localStorage.removeItem('uploadedSurveys');
                    localStorage.removeItem('surveyResults');
                    localStorage.removeItem('totalSurveys');
                    
                    // åˆ·æ–°é¡µé¢æ˜¾ç¤º
                    loadUploadedSurveys();
                    loadStatistics();
                    
                    alert('æ‰€æœ‰æ•°æ®å·²æ¸…ç©ºï¼');
                }
            }
        }

        // åŠ è½½ç»Ÿè®¡æ•°æ®
        function loadStatistics() {
            try {
                const surveyResults = JSON.parse(localStorage.getItem('surveyResults') || '[]');
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const uploadedSurveys = JSON.parse(localStorage.getItem('uploadedSurveys') || '[]');
                
                // ä»ä¸Šä¼ çš„é—®å·æ•°é‡è·å–çœŸå®æ€»æ•°
                const totalUploaded = uploadedSurveys.length;
                const completed = surveyResults.length;
                const inProgress = Math.max(0, Math.floor(totalUploaded * 0.2)); // å‡è®¾20%åœ¨è¿›è¡Œä¸­
                const pending = Math.max(0, totalUploaded - completed - inProgress);
                const completionRate = totalUploaded > 0 ? ((completed / totalUploaded) * 100).toFixed(1) : '0';
                
                const statsContainer = document.getElementById('stats-container');
                if (statsContainer) {
                    statsContainer.innerHTML = `
                        <div class="stat-card">
                            <h3 style="color: #667eea; margin-bottom: 1rem;">æ€»é—®å·æ•°</h3>
                            <div class="stat-number">${totalUploaded}</div>
                            <div class="stat-label">å·²ä¸Šä¼ é—®å·</div>
                        </div>
                        <div class="stat-card">
                            <h3 style="color: #28a745; margin-bottom: 1rem;">å·²å®Œæˆ</h3>
                            <div class="stat-number">${completed}</div>
                            <div class="stat-label">å®Œæˆç‡: ${completionRate}%</div>
                        </div>
                        <div class="stat-card">
                            <h3 style="color: #ffc107; margin-bottom: 1rem;">è¿›è¡Œä¸­</h3>
                            <div class="stat-number">${inProgress}</div>
                            <div class="stat-label">éƒ¨åˆ†å®Œæˆ</div>
                        </div>
                        <div class="stat-card">
                            <h3 style="color: #dc3545; margin-bottom: 1rem;">æœªå¼€å§‹</h3>
                            <div class="stat-number">${pending}</div>
                            <div class="stat-label">ç­‰å¾…å¡«å†™</div>
                        </div>
                        <div class="stat-card">
                            <h3 style="color: #17a2b8; margin-bottom: 1rem;">æ³¨å†ŒåŒ»ç”Ÿ</h3>
                            <div class="stat-number">${users.length}</div>
                            <div class="stat-label">å‚ä¸ä¸“å®¶</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('åŠ è½½ç»Ÿè®¡æ•°æ®æ—¶å‡ºé”™:', error);
                const statsContainer = document.getElementById('stats-container');
                if (statsContainer) {
                    statsContainer.innerHTML = '<div class="stat-card"><p style="color: red;">åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥</p></div>';
                }
            }
        }

        // é¡µé¢åˆ‡æ¢
        function showPage(pageId) {
            // æƒé™æ£€æŸ¥
            if ((pageId === 'admin' || pageId === 'results') && userData.currentUser.role !== 'admin') {
                alert('æ‚¨æ²¡æœ‰æƒé™è®¿é—®è¯¥é¡µé¢ï¼');
                return;
            }
            
            // éšè—æ‰€æœ‰é¡µé¢
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // æ˜¾ç¤ºç›®æ ‡é¡µé¢
            document.getElementById(pageId).classList.add('active');
            
            // å¦‚æœæ˜¯ç»“æœç»Ÿè®¡é¡µé¢ï¼ŒåŠ è½½æœ€æ–°æ•°æ®
            if (pageId === 'results') {
                loadStatistics();
            }
            
            // æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // æ‰¾åˆ°å¹¶æ¿€æ´»å¯¹åº”çš„æŒ‰é’®
            const targetBtn = Array.from(document.querySelectorAll('.nav-btn')).find(btn => 
                btn.textContent.includes(getPageTitle(pageId))
            );
            if (targetBtn) {
                targetBtn.classList.add('active');
            }
        }

        function getPageTitle(pageId) {
            const titles = {
                'admin': 'ç®¡ç†ç•Œé¢',
                'surveys': 'é—®å·å¡«å†™',
                'results': 'ç»“æœç»Ÿè®¡'
            };
            return titles[pageId] || '';
        }

        // ç–¾ç—…æ ‡ç­¾åˆ‡æ¢
        function switchDiseaseTab(disease, element) {
            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            element.parentElement.querySelectorAll('.disease-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            element.classList.add('active');
            
            // æ˜¾ç¤ºå¯¹åº”å†…å®¹
            document.querySelectorAll('.disease-content').forEach(content => {
                content.style.display = 'none';
            });
            document.getElementById(disease + '_content').style.display = 'block';
        }

        // é—®å·æ ‡ç­¾åˆ‡æ¢
        function switchSurveyTab(type, element) {
            element.parentElement.querySelectorAll('.disease-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            element.classList.add('active');
            
            document.querySelectorAll('.survey-content').forEach(content => {
                content.style.display = 'none';
            });
            document.getElementById(type + '-survey-list').style.display = 'block';
        }

        // æ‰“å¼€å…·ä½“é—®å·
        function openSurvey(patientId) {
            document.getElementById('survey-detail').classList.add('active');
            document.getElementById('surveys').classList.remove('active');
            updateProgress();
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress() {
            const form = document.getElementById('survey-form');
            if (!form) return;
            
            const requiredInputs = form.querySelectorAll('input[type="radio"]:checked');
            const totalRequired = 8; // é¢„æµ‹ + åå¥½ + 6ä¸ªè¯„åˆ†ç»´åº¦
            const progress = Math.min((requiredInputs.length / totalRequired) * 100, 100);
            
            const progressFill = document.querySelector('.progress-fill');
            if (progressFill) {
                progressFill.style.width = progress + '%';
            }
        }

        // è®¾ç½®è¯„åˆ†
        function setRating(category, value, element) {
            surveyData.ratings[category] = value;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const container = element.parentElement;
            container.querySelectorAll('.rating-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            element.classList.add('selected');
            
            updateProgress();
        }

        // åˆ‡æ¢æŠ¥å‘Šæ˜¾ç¤º
        function toggleReport(modelId) {
            const content = document.getElementById(modelId + '-content');
            const toggle = document.getElementById(modelId + '-toggle');
            
            if (content && toggle) {
                if (content.style.display === 'none') {
                    content.style.display = 'block';
                    toggle.textContent = 'æ”¶èµ· â–²';
                } else {
                    content.style.display = 'none';
                    toggle.textContent = 'å±•å¼€ â–¼';
                }
            }
        }

        // æäº¤é—®å·
        function submitSurvey() {
            const form = document.getElementById('survey-form');
            if (!form) return;
            
            const formData = new FormData(form);
            const data = Object.fromEntries(formData);
            
            // æ·»åŠ è¯„åˆ†æ•°æ®
            data.ratings = surveyData.ratings;
            data.reasoning = document.getElementById('reasoning')?.value || '';
            data.preferenceReason = document.getElementById('preference-reason')?.value || '';
            data.additionalFeedback = document.getElementById('additional-feedback')?.value || '';
            data.timestamp = new Date().toISOString();
            data.doctorInfo = userData.currentUser;
            data.patientId = 'P-0000597'; // è¿™é‡Œåº”è¯¥æ ¹æ®å®é™…ç—…ä¾‹IDè®¾ç½®
            data.caseNumber = '32'; // ç—…ä¾‹ç¼–å·
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            const existingSurveys = JSON.parse(localStorage.getItem('surveyResults') || '[]');
            existingSurveys.push(data);
            localStorage.setItem('surveyResults', JSON.stringify(existingSurveys));
            
            console.log('é—®å·æ•°æ®:', data);
            
            alert('é—®å·æäº¤æˆåŠŸï¼æ„Ÿè°¢æ‚¨çš„å‚ä¸ã€‚');
            
            // å¦‚æœå½“å‰ç”¨æˆ·æ˜¯ç®¡ç†å‘˜ï¼Œåˆ·æ–°ç»Ÿè®¡æ•°æ®
            if (userData.currentUser.role === 'admin') {
                loadStatistics();
            }
            
            showPage('surveys');
        }

        // å¯¼å‡ºç»“æœ
        function exportResults() {
            try {
                const surveyResults = JSON.parse(localStorage.getItem('surveyResults') || '[]');
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const uploadedSurveys = JSON.parse(localStorage.getItem('uploadedSurveys') || '[]');
                
                // ä»ä¸Šä¼ çš„é—®å·æ•°é‡è·å–çœŸå®æ€»æ•°
                const totalUploaded = uploadedSurveys.length;
                const completed = surveyResults.length;
                const inProgress = Math.max(0, Math.floor(totalUploaded * 0.2));
                const pending = Math.max(0, totalUploaded - completed - inProgress);
                
                const results = {
                    summary: {
                        totalSurveys: totalUploaded,
                        completed: completed,
                        inProgress: inProgress,
                        pending: pending,
                        totalUsers: users.length,
                        completionRate: totalUploaded > 0 ? ((completed / totalUploaded) * 100).toFixed(1) + '%' : '0%'
                    },
                    uploadedSurveys: uploadedSurveys.map(survey => ({
                        id: survey.id,
                        title: survey.title,
                        patientId: survey.patientId,
                        drug: survey.drug,
                        diseaseType: survey.diseaseType,
                        fileName: survey.fileName,
                        uploadTime: survey.uploadTime
                    })),
                    surveyData: surveyResults,
                    userData: users.map(user => ({
                        name: user.name || 'æœªçŸ¥',
                        title: user.title || 'æœªçŸ¥',
                        specialty: user.specialty || 'æœªçŸ¥',
                        experience: user.experience || 'æœªçŸ¥',
                        hospital: user.hospital || 'æœªå¡«å†™',
                        registrationTime: user.registrationTime || new Date().toISOString()
                    })),
                    exportTime: new Date().toISOString(),
                    exportedBy: (userData.currentUser && userData.currentUser.name) || 'ç³»ç»Ÿç®¡ç†å‘˜'
                };
                
                const dataStr = JSON.stringify(results, null, 2);
                const blob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'survey_results_' + new Date().toISOString().slice(0,10) + '.json';
                a.click();
                URL.revokeObjectURL(url);
                
                alert('æ•°æ®å¯¼å‡ºæˆåŠŸï¼æ–‡ä»¶å·²ä¸‹è½½åˆ°æ‚¨çš„ç”µè„‘ã€‚');
            } catch (error) {
                console.error('å¯¼å‡ºæ•°æ®æ—¶å‡ºé”™:', error);
                alert('å¯¼å‡ºæ•°æ®æ—¶å‡ºç°é”™è¯¯ï¼š' + error.message + '\nè¯·è”ç³»ç³»ç»Ÿç®¡ç†å‘˜ã€‚');
            }
        }

        // æ–‡ä»¶ä¸Šä¼ å¤„ç†
        function initFileUpload() {
            const breastUpload = document.getElementById('breast-upload');
            const lungUpload = document.getElementById('lung-upload');
            
            if (breastUpload) breastUpload.addEventListener('change', handleFileUpload);
            if (lungUpload) lungUpload.addEventListener('change', handleFileUpload);
            
            // æ‹–æ‹½ä¸Šä¼ 
            document.querySelectorAll('.upload-area').forEach(area => {
                area.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    area.classList.add('dragover');
                });
                
                area.addEventListener('dragleave', () => {
                    area.classList.remove('dragover');
                });
                
                area.addEventListener('drop', (e) => {
                    e.preventDefault();
                    area.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    handleFileUpload({target: {files}});
                });
            });
        }

        function handleFileUpload(event) {
            const files = event.target.files;
            if (userData.currentUser.role !== 'admin') {
                alert('åªæœ‰ç®¡ç†å‘˜å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼');
                return;
            }
            
            if (files.length === 0) {
                alert('è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼');
                return;
            }
            
            const uploadButton = event.target;
            const diseaseType = uploadButton.id.includes('breast') ? 'breast_cancer' : 'lung_cancer';
            
            Array.from(files).forEach(file => {
                processUploadedFile(file, diseaseType);
            });
        }

        // å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶
        function processUploadedFile(file, diseaseType) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    const survey = parseQuestionnaireFile(content, file.name);
                    
                    if (survey) {
                        // ä¿å­˜é—®å·åˆ°localStorage
                        const existingSurveys = JSON.parse(localStorage.getItem('uploadedSurveys') || '[]');
                        survey.id = Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                        survey.diseaseType = diseaseType;
                        survey.uploadTime = new Date().toISOString();
                        survey.fileName = file.name;
                        existingSurveys.push(survey);
                        localStorage.setItem('uploadedSurveys', JSON.stringify(existingSurveys));
                        
                        // æ›´æ–°æ˜¾ç¤º
                        displayUploadedSurvey(survey, diseaseType);
                        
                        // æ›´æ–°é—®å·æ€»æ•°
                        const currentTotal = parseInt(localStorage.getItem('totalSurveys') || '0');
                        localStorage.setItem('totalSurveys', (currentTotal + 1).toString());
                        
                        alert(`é—®å·"${file.name}"ä¸Šä¼ æˆåŠŸï¼`);
                        
                        // åˆ·æ–°ç»Ÿè®¡æ•°æ®
                        if (document.getElementById('stats-container')) {
                            loadStatistics();
                        }
                    } else {
                        alert(`æ–‡ä»¶"${file.name}"æ ¼å¼ä¸æ­£ç¡®ï¼Œæ— æ³•è§£æï¼`);
                    }
                } catch (error) {
                    console.error('å¤„ç†æ–‡ä»¶æ—¶å‡ºé”™:', error);
                    alert(`å¤„ç†æ–‡ä»¶"${file.name}"æ—¶å‡ºé”™: ${error.message}`);
                }
            };
            
            reader.onerror = function() {
                alert(`è¯»å–æ–‡ä»¶"${file.name}"å¤±è´¥ï¼`);
            };
            
            reader.readAsText(file, 'UTF-8');
        }

        // è§£æé—®å·æ–‡ä»¶å†…å®¹
        function parseQuestionnaireFile(content, fileName) {
            try {
                // å¦‚æœæ˜¯JSONæ ¼å¼
                if (fileName.endsWith('.json')) {
                    return JSON.parse(content);
                }
                
                // è§£æMarkdownæ ¼å¼çš„é—®å·
                const survey = {
                    title: '',
                    caseNumber: '',
                    patientId: '',
                    drug: '',
                    patientInfo: {},
                    modelReports: {
                        modelA: '',
                        modelB: ''
                    }
                };
                
                // æå–ç—…ä¾‹ç¼–å·
                const caseMatch = content.match(/ç—…ä¾‹\s*(\d+)/);
                if (caseMatch) {
                    survey.caseNumber = caseMatch[1];
                    survey.title = `ç—…ä¾‹ ${caseMatch[1]}`;
                }
                
                // æå–æ‚£è€…ID
                const patientIdMatch = content.match(/æ‚£è€…ID[ï¼š:]\s*(P-\d+)/);
                if (patientIdMatch) {
                    survey.patientId = patientIdMatch[1];
                }
                
                // æå–æ²»ç–—è¯ç‰©
                const drugMatch = content.match(/æ²»ç–—è¯ç‰©[ï¼š:]\s*([^\n]+)/);
                if (drugMatch) {
                    survey.drug = drugMatch[1].replace(/\s*\([^)]*\)/, '');
                }
                
                // æå–æ‚£è€…åŸºæœ¬ä¿¡æ¯
                const basicInfoSection = content.match(/\*\*åŸºæœ¬ä¿¡æ¯:\*\*([\s\S]*?)(?:\*\*|$)/);
                if (basicInfoSection) {
                    const basicInfo = basicInfoSection[1];
                    
                    // æå–å„ä¸ªå­—æ®µ
                    const genderMatch = basicInfo.match(/æ€§åˆ«[ï¼š:]?\s*([^\n]+)/);
                    if (genderMatch) survey.patientInfo.gender = genderMatch[1].trim();
                    
                    const ageMatch = basicInfo.match(/å¹´é¾„[ï¼š:]?\s*([^\n]+)/);
                    if (ageMatch) survey.patientInfo.age = ageMatch[1].trim();
                    
                    const raceMatch = basicInfo.match(/ç§æ—[ï¼š:]?\s*([^\n]+)/);
                    if (raceMatch) survey.patientInfo.race = raceMatch[1].trim();
                    
                    const smokingMatch = basicInfo.match(/å¸çƒŸå²[ï¼š:]?\s*([^\n]+)/);
                    if (smokingMatch) survey.patientInfo.smoking = smokingMatch[1].trim();
                }
                
                // æå–è¯Šæ–­ä¿¡æ¯
                const diagnosisMatch = content.match(/è¯Šæ–­[ï¼š:]\s*([^\n]+)/);
                if (diagnosisMatch) survey.patientInfo.diagnosis = diagnosisMatch[1].trim();
                
                // æå–åˆ†æœŸ
                const stageMatch = content.match(/æœ€é«˜è®°å½•åˆ†æœŸ[ï¼š:]\s*([^\n]+)/);
                if (stageMatch) survey.patientInfo.stage = stageMatch[1].trim();
                
                // æå–TMB
                const tmbMatch = content.match(/TMB[^ï¼š:]*[ï¼š:]\s*([^\n]+)/);
                if (tmbMatch) survey.patientInfo.tmb = tmbMatch[1].trim();
                
                // æå–åŸºå› çªå˜
                const mutationMatch = content.match(/å…³é”®åŸºå› çªå˜[ï¼š:]\s*([^\n]+)/);
                if (mutationMatch) survey.patientInfo.mutations = mutationMatch[1].trim();
                
                // æå–æ¨¡å‹AæŠ¥å‘Š
                const modelAMatch = content.match(/\*\*æ¨¡å‹A[ï¼š:]?ç”Ÿæˆçš„æŠ¥å‘Š\*\*([\s\S]*?)(?=\*\*æ¨¡å‹B|$)/);
                if (modelAMatch) {
                    survey.modelReports.modelA = modelAMatch[1].trim();
                }
                
                // æå–æ¨¡å‹BæŠ¥å‘Š
                const modelBMatch = content.match(/\*\*æ¨¡å‹B[ï¼š:]?ç”Ÿæˆçš„æŠ¥å‘Š\*\*([\s\S]*?)(?=\*\*2\.1|$)/);
                if (modelBMatch) {
                    survey.modelReports.modelB = modelBMatch[1].trim();
                }
                
                // éªŒè¯å¿…è¦å­—æ®µ
                if (!survey.patientId || !survey.drug) {
                    throw new Error('ç¼ºå°‘å¿…è¦çš„æ‚£è€…ä¿¡æ¯ï¼ˆæ‚£è€…IDæˆ–æ²»ç–—è¯ç‰©ï¼‰');
                }
                
                return survey;
                
            } catch (error) {
                console.error('è§£æé—®å·æ–‡ä»¶æ—¶å‡ºé”™:', error);
                throw error;
            }
        }

        // æ˜¾ç¤ºä¸Šä¼ çš„é—®å·
        function displayUploadedSurvey(survey, diseaseType) {
            const containerSelector = diseaseType === 'breast_cancer' ? '#breast-surveys' : '#lung-surveys';
            const container = document.querySelector(containerSelector);
            
            if (container) {
                const surveyCard = document.createElement('div');
                surveyCard.className = 'survey-card';
                surveyCard.onclick = () => openUploadedSurvey(survey.id);
                
                surveyCard.innerHTML = `
                    <div class="card-header">
                        <div class="card-title">${survey.title || 'é—®å·'}</div>
                        <div class="card-status status-pending">å·²ä¸Šä¼ </div>
                    </div>
                    <div class="card-info">
                        <strong>æ‚£è€…ID:</strong> ${survey.patientId}<br>
                        <strong>æ²»ç–—è¯ç‰©:</strong> ${survey.drug}<br>
                        <strong>æ€§åˆ«:</strong> ${survey.patientInfo.gender || 'æœªçŸ¥'} | 
                        <strong>å¹´é¾„:</strong> ${survey.patientInfo.age || 'æœªçŸ¥'}<br>
                        <strong>åˆ†æœŸ:</strong> ${survey.patientInfo.stage || 'æœªçŸ¥'}<br>
                        <small style="color: #666;">æ–‡ä»¶: ${survey.fileName}</small>
                    </div>
                `;
                
                container.appendChild(surveyCard);
            }
        }

        // æ‰“å¼€ä¸Šä¼ çš„é—®å·
        function openUploadedSurvey(surveyId) {
            const surveys = JSON.parse(localStorage.getItem('uploadedSurveys') || '[]');
            const survey = surveys.find(s => s.id === surveyId);
            
            if (survey) {
                // è¿™é‡Œå¯ä»¥åŠ¨æ€ç”Ÿæˆé—®å·é¡µé¢æˆ–è€…è·³è½¬åˆ°å¯¹åº”çš„é—®å·
                alert(`æ‰“å¼€é—®å·: ${survey.title}\næ‚£è€…ID: ${survey.patientId}\nè¯ç‰©: ${survey.drug}`);
                // å®é™…é¡¹ç›®ä¸­å¯ä»¥åœ¨è¿™é‡Œè·³è½¬åˆ°å…·ä½“çš„é—®å·å¡«å†™é¡µé¢
            }
        }
    </script>
</body>
</html>